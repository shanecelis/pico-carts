pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
music(0)

x = 10
y = 10
t = 0 -- time
mt = 0 -- move time
health=30
palt(0, false)
palt(15, true)
swing_start= -100
swing_duration = 8

function draw_sword()
  local f = t - swing_start
  if f == 0 then
    -- first frame of sword swing
    sfx(2)
  end
  if f < swing_duration then
    if f > swing_duration/2 then
      f = swing_duration - f
    end
    spr(2,x+6+f,y)
    sword_point = {x+6+f+7,
                   y+4}
--    pset(sword_point[1], 
--         sword_point[2], 8)
  end
end

function point_in_line(px,
                       x0,
                       x1)
  if px >= x0 then
    return true
  elseif px <  x0 then
    return 
  else
    return false
  end
                       
end

function point_in_rect(px,py,
                       x0,y0,
                       x1,y1)

  return true -- if point is in rect
end

function _draw()
   
  t = t + 1

  if health <= 0 then
    game_over("you died")
    return
  elseif (x + 8 < 0 or x > 127) or (y + 8 < 0 or y > 127) then
    outside()
    return
  end
  cls(11)
  speed = 1
  if btn(âŽ) then
    speed = 2
  end
  if btnp(ðŸ…¾ï¸) then 
--  spr(002,x+8,y) 
    -- only swing the sword once our
    -- last swing has finished.
    if t - swing_start > swing_duration then
      swing_start=t
    end
  end
  if btn(âž¡ï¸) then
    x=x+speed
    mt = mt + 1
  end
  if btn(â¬…ï¸) then
    x=x-speed
    mt = mt + 1
  end
  if btn(â¬‡ï¸) then
    y=y+speed
    mt = mt + 1
  end
  if btn(â¬†ï¸) then
    y=y-speed
    mt = mt +1
  end
  -- draw horse
  spr(66, 80, 80, 4, 4)
  local c = 6
  if point_in_line(x, 80, 80+4*8) then
    c = 8
  end
  rect(80,     80,
       80+4*8, 80+4*8, c)
  if x > 70 and x < 70 + 60 
     and y > 70 and y < 70 + 60 then
    -- you're too close to the boss
    sfx(1)
    health=health-1
  end
  b=flr(mt/4%3)
  spr(5, x, y-b, 1, (6 + b)/8)
  draw_sword()
end
function set_music(n)
  if _music and _music == n then
    -- do nothing. music already set.
    return false
  else
    _music = n
    music(n)
    return true
  end
end
function game_over(msg)
  cls()
  set_music(1)
  print("\^w\^tgame oder", 64 - 8 * 9/2, 64 - 8)
  print("\^w\^t"..msg, 64 - 8 * #msg/2, 64 - 8+16)
  if btnp(ðŸ…¾ï¸) then  
    health= 30
    x=10 y=10
    _outside_msg = nil
    music(0)
  end
end
function outside()
  if not _outside_msg then  
    set_music(2)
    cls()
    print("\^d3oh my god, you went outside.")
    _outside_msg = true
  end
  game_over("i got milked")
end --game oder you lived
__gfx__
0000000022222200ffffffff0000000000000000cccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000022222022ffffffff0000000000000000c4cccc4c00000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070044440444ffffffff0000000000000000cccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000eee0eeccf9c94fff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000ee0ee0eefc924aaa00000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700ee0ee0eef9c94fff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e0eeeec0ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e0eeeec0ffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000002200000000000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000002200000000000220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000aa000000000000000aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000aaaa0000000000000aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000aa0000000000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000aaa000000000aa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000aa000000aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000aaaaaaaa000000ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000aaaaa0000000ddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000ddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000ddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000dd0000ddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000dd0000dddd0dd0dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000dd0ddddddd0dd0dddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000dd0dddddddddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000dddddddddddddd000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000ddd000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000dd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200003965039650396503265039650356503965037650376503865037650356503565031650316502d6502d65027650226501d65019650146500f6500c6500865018650066500365002650006500060000600
00020000196500e6502c6502c6502c650176502d6501b6502f6501a6501b65032650186501a65034650226502565035650366503665036650366503465023650216501d65029650166502e65011650276500d650
00020000180501b0501f0502305025050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000002305022050200501e0501c0501a0501805017050200500000000000000002e150000001e150000000000000000221500000000000000000b450000000000000000204502045000000254502745000000
00100000000002a4500645031450304502f45030450164501445017450000001155000000234502c450000003445000000394503c4500845000450144501b450000000000021650226502365000000000002e750
__music__
02 03424344
03 04424344

